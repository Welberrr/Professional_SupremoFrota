<div *ngIf="!modoEdicao">

    <p-panel header="Tipos Veículos" class="mb-4">
        <div class="flex align-items-center gap-4">
            <div class="flex align-items-center">
                <p-radiobutton name="status" value="ativos" inputId="rbAtivos" 
                               [(ngModel)]="statusSelecionado"
                               (ngModelChange)="filtrarPorStatus()">
                </p-radiobutton>
                <label for="rbAtivos" class="ml-2">Ativos</label>
            </div>
            <div class="flex align-items-center">
                <p-radiobutton name="status" value="inativo" inputId="rbInativo" 
                               [(ngModel)]="statusSelecionado"
                               (ngModelChange)="filtrarPorStatus()">
                </p-radiobutton>
                <label for="rbInativo" class="ml-2">Inativo</label>
            </div>
        </div>
    </p-panel>

    <p-panel header="Resultado Pesquisa">
        <p-table #dt [value]="veiculosExibidos" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]"
                 [globalFilterFields]="['requisicao', 'placa', 'kmChegada']">

            <ng-template pTemplate="caption">
                <div class="flex align-items-center">
                    <div class="flex align-items-center">
                        <label class="mr-2">Mostrar</label>
                        <select class="p-inputtext p-component" style="width: auto;">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                        <span class="ml-2">registros</span>
                    </div>
                    <div class="flex align-items-center ml-auto">
                        <label class="mr-2">Buscar:</label>
                        <input type="text" pInputText 
                               (input)="dt.filterGlobal($any($event.target).value, 'contains')" />
                    </div>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="requisicao">REQUISIÇÃO CONCLUÍDA <p-sortIcon field="requisicao"></p-sortIcon></th>
                    <th pSortableColumn="placa">PLACA <p-sortIcon field="placa"></p-sortIcon></th>
                    <th>KM ATUAL</th>
                    <th pSortableColumn="situacao">SITUAÇÃO <p-sortIcon field="situacao"></p-sortIcon></th>
                    <th>AÇÕES</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-veiculo>
                <tr>
                    <td>{{ veiculo.requisicao }}</td>
                    <td>{{ veiculo.placa }}</td>
                    <td>{{ veiculo.kmChegada | number }}</td>
                    <td class="text-center">
                        <i class="pi" 
                           [ngClass]="{'pi-check-circle': veiculo.situacao, 'pi-times-circle': !veiculo.situacao}"
                           [style.color]="veiculo.situacao ? 'var(--primary-color)' : 'var(--red-500)'">
                        </i>
                    </td>
                    <td class="text-center">
                        <p-button icon="pi pi-pencil" 
                                  styleClass="p-button-text" 
                                  (click)="abrirEdicao(veiculo)"></p-button>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="5">Nenhum registro encontrado.</td>
                </tr>
            </ng-template>

        </p-table>
    </p-panel>

</div>

<div *ngIf="modoEdicao && veiculoSelecionado">

    <p-card>
        <ng-template pTemplate="title">
            Edição Quilometragem
        </ng-template>
        
        <ng-template pTemplate="subtitle">
            {{ veiculoSelecionado.placa }}
        </ng-template>
        
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">

            <div style="flex: 1;">
                <label>Km Saída</label>
                <div class="text-xl font-bold p-3">{{ veiculoSelecionado.kmSaida | number }}</div>
            </div>

            <div style="flex: 1;">
                <label>Km Chegada</label>
                <div class="text-xl font-bold p-3">{{ veiculoSelecionado.kmChegada | number }}</div>
            </div>

            <div style="flex: 1;">
                <label for="kmAlteracao">Km Chegada alteração:</label>
                <input id="kmAlteracao" type="number" pInputText [(ngModel)]="kmChegadaAlterado" style="width: 100%" />
            </div>

        </div>
        
        <div>
            <label for="justificativa">Justificativa:</label>
            <textarea id="justificativa" rows="2" pInputTextarea [(ngModel)]="justificativa" style="width: 100%"></textarea>
        </div>


        <div class="mt-4">
            <p-button label="Salvar" icon="pi pi-check" 
                      styleClass="p-button" 
                      (click)="salvarEdicao()"></p-button>
        </div>

    </p-card>

    <div class="mt-4" style="display: flex; justify-content: flex-end;">
        <p-button label="Voltar" icon="pi pi-arrow-left" 
                  styleClass="p-button-success" 
                  (click)="voltarParaLista()"></p-button>
    </div>

</div>